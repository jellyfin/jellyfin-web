<!doctype html>
<html class="preload" dir="ltr">
    <head>
        <script>
            // Define globals for legacy libraries
            window.global = window;
            window.process = { env: { NODE_ENV: 'development' } };
        </script>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
        />
        <link rel="manifest" href="manifest.json" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <meta http-equiv="X-UA-Compatibility" content="IE=Edge" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="application-name" content="Jellyfin" />
        <meta name="robots" content="noindex, nofollow, noarchive" />
        <meta name="referrer" content="no-referrer" />

        <meta id="themeColor" name="theme-color" content="#202020" />

        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="../node_modules/@jellyfin/ux-web/favicons/touchicon.png"
        />
        <link
            rel="shortcut icon"
            href="../node_modules/@jellyfin/ux-web/favicons/favicon.ico"
        />
        <meta
            name="msapplication-TileImage"
            content="../node_modules/@jellyfin/ux-web/favicons/touchicon144.png"
        />
        <meta name="msapplication-TileColor" content="#333333" />

        <title>Jellyfin Web Next</title>

        <!-- Resource hints for better performance -->
        <link rel="dns-prefetch" href="//fonts.googleapis.com" />
        <link
            rel="preconnect"
            href="https://fonts.googleapis.com"
            crossorigin
        />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <style>
            /* Critical CSS - Inline styles for initial load performance */
            /* Extracted from site.scss and other critical styles */

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            html {
                height: 100%;
                font-family: Arial, Helvetica, sans-serif;
                line-height: 1.35;
            }

            body {
                height: 100%;
                overflow-x: hidden;
                background-color: transparent !important;
                -webkit-font-smoothing: antialiased;
            }

            @keyframes fadein {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }

            .splashLogo {
                animation: fadein 0.5s;
                width: 30%;
                height: 30%;
                background-image: url("../node_modules/@jellyfin/ux-web/favicons/touchicon.png");
                background-position: center center;
                background-repeat: no-repeat;
                background-size: contain;
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            /* Preload critical images */
            .splashLogo::before {
                content: "";
                display: block;
                background-image: url("../node_modules/@jellyfin/ux-web/favicons/touchicon.png");
            }

            /* Critical layout styles */
            #reactRoot {
                height: 100%;
            }

            /* Hide elements that should be hidden initially */
            .hide {
                display: none !important;
            }

            /* Basic responsive design */
            @media screen and (min-device-width: 992px) {
                .splashLogo {
                    background-image: url("favicons/banner-light.png");
                }
            }

            /* Theme color for PWA */
            .themeBg {
                background-color: #101010;
            }

            /* Prevent layout shift during loading */
            .skinHeader,
            .mainDrawerPanel,
            .layoutManager {
                display: none;
            }

            /* Show only the loading screen initially */
            .splashLogo {
                display: block;
            }

            /* Existing styles for compatibility */
            .transparentDocument,
            .backgroundContainer-transparent:not(.withBackdrop) {
                background: none !important;
                background-color: transparent !important;
            }

            .layout-tv .mouseIdle,
            .layout-tv .mouseIdle button,
            .layout-tv .mouseIdle select,
            .layout-tv .mouseIdle input,
            .layout-tv .mouseIdle textarea,
            .layout-tv .mouseIdle a,
            .layout-tv .mouseIdle label,
            .transparentDocument .mouseIdle,
            .transparentDocument .mouseIdle button,
            .transparentDocument .mouseIdle select,
            .transparentDocument .mouseIdle input,
            .transparentDocument .mouseIdle textarea,
            .transparentDocument .mouseIdle a,
            .transparentDocument .mouseIdle label,
            .screensaver-noScroll.mouseIdle,
            .screensaver-noScroll.mouseIdle button,
            .screensaver-noScroll.mouseIdle select,
            .screensaver-noScroll.mouseIdle input,
            .screensaver-noScroll.mouseIdle textarea,
            .screensaver-noScroll.mouseIdle a,
            .screensaver-noScroll.mouseIdle label {
                cursor: none !important;
            }

            .preload {
                background-color: #101010;
            }

            .layout-desktop .hide-desktop,
            .layout-mobile .hide-mobile,
            .layout-tv .hide-tv,
            .mouseIdle .hide-mouse-idle,
            .mouseIdle-tv .hide-mouse-idle-tv {
                display: none !important;
            }

            .mainDrawerHandle {
                position: fixed;
                top: 0;
                bottom: 0;
                z-index: 1;
                width: 0.8em;
                padding-left: env(safe-area-inset-left);
                caret-color: transparent;
            }

            [dir="ltr"] .mainDrawerHandle {
                left: 0;
            }

            [dir="rtl"] .mainDrawerHandle {
                left: 0;
            }
        </style>
    </head>
    <body dir="ltr" class="mouseIdle">
        <div id="reactRoot">
            <div class="splashLogo"></div>
        </div>

        <!-- Load CSS asynchronously as fallback -->
        <script>
            // Load non-critical CSS asynchronously
            function loadCSS(href) {
                var link = document.createElement("link");
                link.rel = "stylesheet";
                link.href = href;
                link.media = "print";
                link.onload = function () {
                    this.media = "all";
                };
                document.head.appendChild(link);
            }

            // Load main CSS if preload didn't work
            if (!document.querySelector('link[href*="main.jellyfin.css"]')) {
                loadCSS("main.jellyfin.css");
            }
        </script>
        <!-- Register service worker -->
        <script>
            // Unregister stale service workers in development mode
            if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.getRegistrations().then(function(registrations) {
                        for (let registration of registrations) {
                            registration.unregister();
                            console.log('[PWA] Unregistered stale service worker');
                        }
                    });
                }
            }
        </script>
        <script type="module" src="/index.jsx"></script>
    </body>
</html>
